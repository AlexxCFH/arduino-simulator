<div class="protoboard-container">
  <h2>Protoboard Virtual</h2>

  <div class="protoboard-info">
    <p class="info-text">
      üí° <strong>Conexiones verticales:</strong> Los agujeros de la misma columna est√°n conectados (ej: A1-B1-C1-D1-E1)
    </p>
  </div>

  <div
    class="grid"
    [class.placement-mode]="selection.isPlacementMode()"
    [class.wiring-mode]="selection.isWiringMode()">
    
    <!-- Labels de columnas con indicador de conectividad -->
    <div class="column-labels">
      <div class="label-spacer"></div>
      @for (col of cols; track col) {
        <div class="column-label" 
             [class.has-connectivity]="hasVerticalConnectivity(col)"
             [title]="hasVerticalConnectivity(col) ? 'Columna ' + (col + 1) + ': ' + getComponentsInColumn(col) + ' componente(s) conectado(s)' : 'Columna ' + (col + 1) + ': Sin componentes'">
          {{ col + 1 }}
          @if (hasVerticalConnectivity(col)) {
            <span class="connectivity-dot">‚óè</span>
          }
        </div>
      }
    </div>

    <!-- Secci√≥n superior (filas A-E) -->
    <div class="section section-top">
      @for (row of topRows; track row) {
        <div class="row-container">
          <div class="row-label">{{ getRowLabel(row) }}</div>
          <div class="row">
            @for (col of cols; track col) {
              <div
                class="hole"
                [class.occupied]="isOccupied(row, col)"
                [class.in-connected-column]="hasVerticalConnectivity(col)"
                [class.hover-valid]="(selection.isPlacementMode() || selection.isWiringMode()) && !isOccupied(row, col)"
                [class.wire-start]="isWireStart(row, col)"
                [class.anode]="isPinType(row, col, 'A+')"
                [class.cathode]="isPinType(row, col, 'K-')"
                [class.anode-on]="isPinType(row, col, 'A+') && isPinOn(row, col)"
                [class.cathode-on]="isPinType(row, col, 'K-') && isPinOn(row, col)"
                [class.resistor]="isPinType(row, col, 'RESISTOR')"
                [attr.data-led-color]="getLEDColorForPin(row, col)"
                (click)="onHoleClick(row, col)"
                [title]="getHoleTitle(row, col)">
                @if (getComponentAt(row, col); as component) {
                  <span
                    class="component-icon"
                    [class.led-on]="isLEDOn(component)"
                    [style.color]="getLEDColor(component)">
                    {{ getComponentIcon(component, row, col) }}
                  </span>
                }
              </div>
            }
          </div>
        </div>
      }
    </div>

    <!-- Canal central -->
    <div class="canal-central">
      <div class="canal-line"></div>
    </div>

    <!-- Secci√≥n inferior (filas F-J) -->
    <div class="section section-bottom">
      @for (row of bottomRows; track row) {
        <div class="row-container">
          <div class="row-label">{{ getRowLabel(row) }}</div>
          <div class="row">
            @for (col of cols; track col) {
              <div
                class="hole"
                [class.occupied]="isOccupied(row, col)"
                [class.in-connected-column]="hasVerticalConnectivity(col)"
                [class.hover-valid]="(selection.isPlacementMode() || selection.isWiringMode()) && !isOccupied(row, col)"
                [class.wire-start]="isWireStart(row, col)"
                [class.anode]="isPinType(row, col, 'A+')"
                [class.cathode]="isPinType(row, col, 'K-')"
                [class.anode-on]="isPinType(row, col, 'A+') && isPinOn(row, col)"
                [class.cathode-on]="isPinType(row, col, 'K-') && isPinOn(row, col)"
                [class.resistor]="isPinType(row, col, 'RESISTOR')"
                [attr.data-led-color]="getLEDColorForPin(row, col)"
                (click)="onHoleClick(row, col)"
                [title]="getHoleTitle(row, col)">
                @if (getComponentAt(row, col); as component) {
                  <span
                    class="component-icon"
                    [class.led-on]="isLEDOn(component)"
                    [style.color]="getLEDColor(component)">
                    {{ getComponentIcon(component, row, col) }}
                  </span>
                }
              </div>
            }
          </div>
        </div>
      }
    </div>
  </div>

  <div class="info-panel">
    <p>üì¶ Componentes: {{ componentCount() }}</p>
    <p>‚ö° Estado: {{ simulator.isRunning() ? 'üü¢ Corriendo' : 'üî¥ Detenido' }}</p>

    @if (selection.isPlacementMode()) {
      <p class="placement-hint">
        üëÜ Haz clic en la protoboard para colocar:
        <strong>{{ selection.selectedTemplate()?.name }}</strong>
      </p>
    }

    @if (selection.isWiringMode()) {
      <p class="placement-hint wiring">
        üîå Modo cableado: <strong>{{ selection.selectedTemplate()?.name }}</strong>
        @if (selection.wireStartSet()) {
          <span class="step">‚úÖ Punto inicial ‚Üí üëÜ Selecciona punto final</span>
        } @else {
          <span class="step">üëÜ Selecciona punto inicial</span>
        }
      </p>
    }
  </div>

  <div class="legend">
    <h4>üìñ Leyenda</h4>
    <div class="legend-item">
      <span class="legend-pin anode">+</span>
      <span>√Ånodo (positivo)</span>
    </div>
    <div class="legend-item">
      <span class="legend-pin cathode">-</span>
      <span>C√°todo (negativo)</span>
    </div>
    <div class="legend-item">
      <span class="legend-pin resistor">R</span>
      <span>Resistor</span>
    </div>
    <div class="legend-item">
      <span class="connectivity-indicator">‚óè</span>
      <span>Columna con conectividad vertical</span>
    </div>
  </div>
</div>